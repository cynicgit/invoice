<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <!--[if lt IE 9]>
    <script type="text/javascript" src="lib/html5shiv.js"></script>
    <script type="text/javascript" src="lib/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css"/>
    <link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css"/>
    <link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin"/>
    <link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css"/>
    <link rel="stylesheet" type="text/css" href="static/layui/css/layui.css" media="all">
    <title>添加发票</title>
    <style type="text/css">
    </style>
</head>
<body>

<div class="page-container" id="student-list">
    <form action="" method="post" class="form form-horizontal" id="form-menu-add">
        <!--<div class="row cl">-->
            <!--<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 任务单号：</label>-->
            <!--<div class="formControls col-xs-8 col-sm-9">-->
                <!--<input type="text" class="input-text" value="" placeholder="" id="taskId" >-->
            <!--</div>-->
        <!--</div>-->
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 任务单号：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="taskId">
                </div>
            </div>
        </div>

        <!--<div class="row cl">-->
            <!--<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>合同号：</label>-->
            <!--<div class="formControls col-xs-8 col-sm-9">-->
                <!--<input type="text" class="input-text" value="" placeholder="" id="contractNumber" >-->
            <!--</div>-->
        <!--</div>-->

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 合同号：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="contractNumber">
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 开票日期：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <!--<input type="text" class="input-text" value="" placeholder="" id="invoiceDate">-->
                    <input type="text" class="layui-input" id="invoiceDate">
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>信用类别：</label>
            <div>
                <div class="radio-box">
                    <input name="target" type="radio" id="company" value="企业" checked>
                    <label for="company">企业</label>
                </div>
                <div class="radio-box">
                    <input name="target" type="radio" id="government" value="政府">
                    <label for="government">政府</label>
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>信用期限：</label>
            <div>
                <div class="radio-box">
                    <input name="time" type="radio" id="three-radio" value="3个月" checked>
                    <label for="three-radio">3个月</label>
                </div>
                <div class="radio-box">
                    <input name="time" type="radio" id="six-radio" value="6个月">
                    <label for="six-radio">6个月</label>
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>发票类型：</label>
            <div>
                <div class="radio-box">
                    <input name="type" type="radio" id="ordinary" value="普" checked>
                    <label for="ordinary">普</label>
                </div>
                <div class="radio-box">
                    <input name="type" type="radio" id="special" value="专">
                    <label for="special">专</label>
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 开票单位：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="invoiceOffice" >
                </div>
            </div>
        </div>

        <!--<div class="row cl">-->
            <!--<label class="form-label col-xs-4 col-sm-2" style="margin-left:15px"><span class="c-red">*</span> 所属部门：</label>-->
            <!--<div class="formControls col-xs-8 col-sm-6"> <span class="select-box">-->
				<!--<select id="depId" name="depId" class="select">-->
				<!--</select>-->
				<!--</span></div>-->
        <!--</div>-->

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2">所属部门：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                <span class="select-box">
                    <select id="depId" name="depId" class="select">
                    </select>
                    </span>
                </div>
            </div>
        </div>


        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 项目：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="invoiceProject" >
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 合同金额：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="contractAmount" >
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 发票金额：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="invoiceAmount">
                </div>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 不含税金额：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="noTaxAmount">
                </div>
            </div>
        </div>

        <!--<div class="row cl">-->
            <!--<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 项目负责人：</label>-->
            <!--<div class="formControls col-xs-8 col-sm-6" style="margin-left:15px"> <span class="select-box">-->
				<!--<select id="userId" name="userId" class="select">-->
				<!--</select>-->
				<!--</span></div>-->
        <!--</div>-->

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2">项目负责人：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                <span class="select-box">
                    <select id="userId" name="userId" class="select">
                    </select>
                    </span>
                </div>
            </div>
        </div>



        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"> 签收人：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="invoiceSignatory" >
                </div>
            </div>
        </div>

        <!--<div class="row cl">-->
            <!--<label class="form-label col-xs-4 col-sm-2"> 签收日期：</label>-->

            <!--<div class="formControls col-xs-8 col-sm-9">-->
                <!--<div class="formControls col-xs-8 col-sm-9">-->
                    <!--&lt;!&ndash;<input type="text" class="input-text" value="" placeholder="" id="invoiceSignatoryDate">&ndash;&gt;-->
                    <!--<input type="text" class="layui-input" id="invoiceSignatoryDate">-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"> 报告号：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="reportNumber" >
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"> 报告日期：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <!--<input type="text" class="input-text" value="" placeholder="" id="reportDate">-->
                    <input type="text" class="layui-input" id="reportDate">
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"> 回款金额：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="receivedAmount" >
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"> 回款日期：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <!--<input type="text" class="input-text" value="" placeholder="" id="receivedDate">-->
                    <input type="text" class="layui-input" id="receivedDate">
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"> 未到账：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="noReceivedAmount">
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"> 备注：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="descprition">
                </div>
            </div>
        </div>

        <div class="row cl">
            <div class="col-9 col-offset-2">
                <input style="width:100px" class="btn btn-primary radius" id="submit-btn" type="submit" value="提交">
            </div>
        </div>

    </form>
</div>

<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="lib/laypage/1.2/laypage.js"></script>
<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript" src="static/js/common.js"></script>
<script type="text/javascript" src="static/layui/layui.js"></script>
<script>


    var id = $.cookie("invoice_id");
    $(function () {
        getInvoice();
    });

    $(function () {
        layui.use('laydate', function () {
            var laydate = layui.laydate;
            laydate.render({
                elem: '#receivedDate',
                type: 'date',
                format: 'yyyy-MM-dd HH:mm:ss'
            });
            laydate.render({
                elem: '#reportDate',
                type: 'date',
                format: 'yyyy-MM-dd HH:mm:ss'
            });
            // laydate.render({
            //     elem: '#invoiceSignatoryDate',
            //     type: 'date',
            //     format: 'yyyy-MM-dd HH:mm:ss'
            //
            // });
            laydate.render({
                elem: '#invoiceDate',
                type: 'date',
                format: 'yyyy-MM-dd HH:mm:ss'
            });
        });
    })

    function getInvoice() {

        ajax({
            url: 'invoice?id=' + id,
            type: 'get',
            data: {},
            success: function (res) {
                if (res.result === 0) {
                    console.log(res);

                    var reportNumber = res.data.reportNumber === null ? "" : res.data.reportNumber;
                    var invoiceSignatoryDate = res.data.invoiceSignatoryDate == null?"":dateFormat( res.data.invoiceSignatoryDate);
                    var invoiceDate = res.data.invoiceDate == null?"":dateFormat( res.data.invoiceDate);
                    var reportDate = res.data.invoiceSignatoryDate == null?"":dateFormat( res.data.reportDate);
                    var receivedDate = res.data.invoiceSignatoryDate == null?"":dateFormat( res.data.receivedDate);


                    $('#taskId').val(res.data.taskId);
                    $('#contractNumber').val(res.data.contractNumber);
                    $("input[name='target'][value=" + res.data.creditType + "]").prop("checked", "checked");
                    $("input[name='time'][value=" + res.data.creditLimit + "]").prop("checked", "checked");
                    $("input[name='type'][value=" + res.data.invoiceType + "]").prop("checked", "checked");
                    $('#invoiceOffice').val(res.data.invoiceOffice);
                    $('#depId').append("<option value='" + res.data.depId + "'>" + res.data.departmentName + "</option>");

                    $('#invoiceProject').val(res.data.invoiceProject);
                    $('#contractAmount').val(res.data.contractAmount);
                    $('#invoiceAmount').val(res.data.invoiceAmount);
                   // $("#userId").find("option[value=" + res.data.userId + "]").attr("selected", true);

                    $('#userId').append("<option value='" + res.data.userId + "'>" + res.data.contractUser + "</option>");

                    $('#invoiceSignatory').val(res.data.invoiceSignatory);
                    $('#reportNumber').val(reportNumber);
                    $('#receivedAmount').val(res.data.receivedAmount);
                    $('#reportDate').val(reportDate);
                    $('#invoiceSignatoryDate').val(invoiceSignatoryDate);
                    $('#receivedDate').val(receivedDate);
                    $('#invoiceDate').val(invoiceDate)
                    $('#noReceivedAmount').val(res.data.receivedAmount);
                    $('#descprition').val(res.data.descprition);
                    $("#noTaxAmount").val(res.data.noTaxAmount);
                } else if (res.code === 0) {
                    layer.msg(res.error);
                }
            }
        })
    };


    $('#submit-btn').click(function (e) {
        e.preventDefault();

        var taskId = $('#taskId').val();
        var contractNumber = $('#contractNumber').val();
        var invoiceSignatory = $('#invoiceSignatory').val();
        var invoiceDate = $("#invoiceDate").val();
        var invoiceOffice = $("#invoiceOffice").val();
        var invoiceNumber = $("#invoiceNumber").val();
        var target = $("input[name='target']:checked").val();
        var time = $("input[name='time']:checked").val();
        var type = $("input[name='type']:checked").val();
        var depId = $("#depId").val();
        var departmentName = $("#depId option:selected").text();
        var invoiceProject = $("#invoiceProject").val();
        var contractAmount = $("#contractAmount").val();
        var invoiceAmount = $("#invoiceAmount").val();
        var userId = $("#userId").val();
        var contractUser = $("#userId option:selected").text();
     //   var invoiceSignatoryDate = $("#invoiceSignatoryDate").val();
        var reportNumber = $("#reportNumber").val();
        var reportDate = $("#reportDate").val();
        var receivedAmount = $("#receivedAmount").val();
        var receivedDate = $("#receivedDate").val();
        var noReceivedAmount = $("#noReceivedAmount").val();
        var descprition = $("#descprition").val();
        var noTaxAmount = $("#noTaxAmount").val();

        if (!validateNull(taskId,"任务号")) {return;}
        if (!validateNull(contractNumber,"合同号")) {return;}
        if (!validateNull(invoiceOffice,"开票单位")) {return;}
        if (!validateNull(invoiceNumber,"发票号")) {return;}
        if (!validateNull(departmentName,"所属部门")) {return;}
        if (!validateNull(invoiceProject,"项目")) {return;}
        if (!validateNull(contractUser,"项目负责人")) {return;}
        if (!validateNull(invoiceAmount,"发票金额")) {return;}
        if (!validateNull(contractAmount,"合同金额")) {return;}
        if (!validateNull(noTaxAmount,"不含税金额")) {return;}

        if (!validateNum(contractAmount)) {return;}
        if (!validateNum(invoiceAmount)) {return;}
        if (!validateNum(noTaxAmount)) {return;}
        if (receivedAmount !== "" &&!validateNum(receivedAmount)) {return;}
        if (noReceivedAmount !== "" && !validateNum(noReceivedAmount)) {return;}

        ajax
        ({
            url: 'invoice',
            type: 'put',
            data: {
                id: id,
                taskId: taskId,
                contractNumber: contractNumber,
               // invoiceDate: invoiceDate,
                invoiceOffice: invoiceOffice,
                invoiceNumber: invoiceNumber,
                contractUser:contractUser,
                creditLimit: time,
                creditType:target,
                invoiceType:type,
                depId: depId,
                departmentName: departmentName,
                invoiceProject: invoiceProject,
                contractAmount: contractAmount,
                invoiceAmount: invoiceAmount,
                userId: userId,
                invoiceSignatory: invoiceSignatory,
            //    invoiceSignatoryDate: invoiceSignatoryDate,
                reportNumber: reportNumber,
                reportDate: reportDate,
                receivedAmount: receivedAmount,
                receivedDate: receivedDate,
                noReceivedAmount: noReceivedAmount,
                descprition: descprition,
            },
            success: function (res) {
                if (res.result === 0) {
                    layer.msg('更新成功');
                    setTimeout(function () {
                        parent.location.reload();
                    }, 1500)
                } else if (res.result === 1) {
                    layer.msg(res.error);
                }
            }
        })

    })

</script>
</body>
</html>