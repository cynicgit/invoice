<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <!--[if lt IE 9]>
    <script type="text/javascript" src="lib/html5shiv.js"></script>
    <script type="text/javascript" src="lib/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css"/>
    <link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css"/>
    <link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin"/>
    <link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css"/>
    <link rel="stylesheet" type="text/css" href="static/layui/css/layui.css" media="all">

    <title>添加发票</title>
    <style type="text/css">
    </style>
</head>
<body>

<div class="page-container" id="student-list">
    <form action="" method="post" class="form form-horizontal" id="form-menu-add">

        <!--<div class="row cl">-->
        <!--<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>任务单号：</label>-->
        <!--<div class="formControls col-xs-8 col-sm-9">-->
        <!--<input type="text" class="input-text" value="" placeholder="" id="taskId">-->
        <!--</div>-->
        <!--</div>-->

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>任务单号：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="taskId">
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>合同号：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="contractNumber">
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 发票号：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="invoiceNumber">
                </div>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 开票日期：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <!--<input type="text" class="input-text" value="" placeholder="" id="invoiceDate">-->
                    <input type="text" class="layui-input" id="invoiceDate">
                </div>
            </div>
        </div>

        <!--<div class="row cl">-->
            <!--<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>信用类别：</label>-->
            <!--<div>-->
                <!--<div class="radio-box">-->
                    <!--<input name="target" type="radio" id="company" value="企业" checked>-->
                    <!--<label for="company">企业</label>-->
                <!--</div>-->
                <!--<div class="radio-box">-->
                    <!--<input name="target" type="radio" id="government" value="政府">-->
                    <!--<label for="government">政府</label>-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->

        <!--<div class="row cl">-->
            <!--<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>信用期限：</label>-->
            <!--<div>-->
                <!--<div class="radio-box">-->
                    <!--<input name="time" type="radio" id="three-radio" value="3个月" checked>-->
                    <!--<label for="three-radio">3个月</label>-->
                <!--</div>-->
                <!--<div class="radio-box">-->
                    <!--<input name="time" type="radio" id="six-radio" value="6个月">-->
                    <!--<label for="six-radio">6个月</label>-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 信用期限：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <span class="select-box">
                    <select id="credit" name="taxRate" class="select">
                         <!--<option value="0">0%</option>-->
                        <!--<option value="6">6%</option>-->
                        <!--<option value="9">9%</option>-->
                        <!--<option value="13">13%</option>-->
                    </select>
                    </span>
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>发票类型：</label>
            <div>
                <div class="radio-box">
                    <input name="type" type="radio" id="ordinary" value="普" checked>
                    <label for="ordinary">普</label>
                </div>
                <div class="radio-box">
                    <input name="type" type="radio" id="special" value="专">
                    <label for="special">专</label>
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 开票单位：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="invoiceOffice">
                </div>
            </div>
        </div>


        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 所属部门：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <span class="select-box">
                    <select id="depId-select" name="depId-select" class="select">
                    <option value="">请选择</option>
                    </select>
                    </span>
                </div>
            </div>
        </div>



        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 项目：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                     <span class="select-box">
                    <!--<input type="text" class="input-text" value="" placeholder="" id="invoiceProject">-->
                    <select id="projectId" name="invoiceProject" class="select">
                     <option value="">请选择</option>
                    </select>
                     </span>
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 合同金额：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="contractAmount">
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 发票金额：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="invoiceAmount" onblur="onblus(this)">
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 税率：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <span class="select-box">
                    <select id="taxRate" name="taxRate" class="select">
                         <!--<option value="0">0%</option>-->
                         <!--<option value="6">6%</option>-->
                         <!--<option value="9">9%</option>-->
                         <!--<option value="13">13%</option>-->
                    </select>
                    </span>
                </div>
            </div>
        </div>


        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span> 不含税金额：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="noTaxAmount" disabled>
                </div>
            </div>
        </div>

        <div class="row cl layui-form">
            <div class="layui-form-item">
                <label class="form-label col-xs-4 col-sm-2">项目负责人：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <div class="formControls col-xs-8 col-sm-9">
                <span class="select-box">
                    <select id="userId" name="userId" class="select" lay-verify="" lay-search>
                    <option value="">请选择</option>
                    </select>
                    </span>
                    </div>
                </div>
            </div>
        </div>


        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"> 签收人：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="invoiceSignatory">
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"> 报告号：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="reportNumber">
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"> 报告日期：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="layui-input" id="reportDate">
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"> 回款金额：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="receivedAmount" onblur="onblus(this)">
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"> 回款日期：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="layui-input" id="receivedDate">
                </div>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"> 坏账：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="badAmount" onblur="onblus(this)">
                </div>
            </div>
        </div>


        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"> 未到账：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="noReceivedAmount" disabled>
                </div>
            </div>
        </div>


        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"> 备注：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="" placeholder="" id="descprition">
                </div>
            </div>
        </div>

        <div class="row cl">
            <div class="col-9 col-offset-2">
                <input style="width:100px" class="btn btn-primary radius" id="submit-btn" type="submit" value="提交">
            </div>
        </div>

    </form>
</div>

<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="lib/laypage/1.2/laypage.js"></script>
<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript" src="static/layui/layui.js"></script>
<script type="text/javascript" src="static/js/common.js"></script>
<script type="text/javascript" src="static/js/common-invoice.js"></script>

<script>

    $(function () {

        getDep();
        getUser(null);
        getTaxRate(null);
        getCredit(null);

        layui.use('laydate', function () {
            var laydate = layui.laydate;
            laydate.render({
                elem: '#receivedDate',
                type: 'date',
                format: 'yyyy-MM-dd'
            });
            laydate.render({
                elem: '#reportDate',
                type: 'date',
                format: 'yyyy-MM-dd'
            });
            laydate.render({
                elem: '#invoiceDate',
                type: 'date',
                format: 'yyyy-MM-dd'
            });
        });

        // layui.use('form', function () {
        //     var form = layui.form;
        //     form.render();
        // });



    });




    $('#submit-btn').click(function (e) {
        e.preventDefault();

        var taskId = $('#taskId').val();
        var contractNumber = $('#contractNumber').val();
        var invoiceSignatory = $('#invoiceSignatory').val();
        var invoiceDate = $("#invoiceDate").val();
        var invoiceOffice = $("#invoiceOffice").val();
        var invoiceNumber = $("#invoiceNumber").val();
        var type = $("input[name='type']:checked").val();
      //  var target = $("input[name='target']:checked").val();
      //  var time = $("input[name='time']:checked").val();
        var credit = $("#credit").val();
        var depId = $("#depId-select").val();
        var departmentName = $("#depId-select option:selected").text();
        var parentDep = $("#depId-select option:selected").parent().attr("label");
        departmentName = parentDep + '-' + departmentName
       // var invoiceProject = $("#invoiceProject").val();
        var projectId = $("#projectId").val();
        var invoiceProject = $("#projectId option:selected").text();
        var contractAmount = $("#contractAmount").val();
        var invoiceAmount = $("#invoiceAmount").val();
        var noTaxAmount = $("#noTaxAmount").val();
        var userId = $("#userId").val();
        var contractUser = $("#userId option:selected").text();
        var reportNumber = $("#reportNumber").val();
        var reportDate = $("#reportDate").val();
        var receivedAmount = $("#receivedAmount").val();
        var receivedDate = $("#receivedDate").val();
        var noReceivedAmount = $("#noReceivedAmount").val();
        var badAmount = $("#badAmount").val();
        var taxRate = $("#taxRate").val();
        var descprition = $("#descprition").val();


        if (!validateNull(taskId, "任务号")) {
            return;
        }
        if (!validateNull(contractNumber, "合同号")) {
            return;
        }
        if (!validateNull(invoiceOffice, "开票单位")) {
            return;
        }
        if (!validateNull(invoiceNumber, "发票号")) {
            return;
        }
        if (!validateNull(departmentName, "所属部门")) {
            return;
        }
        if (!validateNull(invoiceProject, "项目")) {
            return;
        }
        if (!validateNull(contractUser, "项目负责人")) {
            return;
        }
        if (!validateNull(invoiceAmount, "发票金额") && !validateNum(invoiceAmount, "发票金额")) {
            return;
        }
        if (!validateNull(contractAmount, "合同金额") && !validateNum(contractAmount, "合同金额")) {
            return;
        }
        if (!validateNull(noTaxAmount, "不含税金额") && !validateNum(noTaxAmount, "不含税金额")) {
            return;
        }

        if (badAmount !== '' && !validateNum(badAmount, "坏账")) {
            return;
        }
        if (receivedAmount !== '' && !validateNum(receivedAmount, "回款金额")) {
            return;
        }
        if (noReceivedAmount !== '' && !validateNum(noReceivedAmount, "未到账金额")) {
            return;
        }


        ajax
        ({
            url: 'invoice',
            type: 'post',
            data: {
                taskId: taskId,
                contractNumber: contractNumber,
                invoiceDate: invoiceDate,
                invoiceOffice: invoiceOffice,
                invoiceNumber: invoiceNumber,
               // creditType: target,
                contractUser: contractUser,
                creditLimit: credit,
                invoiceType: type,
                taskId: taskId,
                depId: depId,
                departmentName: departmentName,
                invoiceProject: invoiceProject,
                projectId:projectId,
                contractAmount: contractAmount,
                invoiceAmount: invoiceAmount,
                noTaxAmount: noTaxAmount,
                userId: userId,
                invoiceSignatory: invoiceSignatory,
                //k    invoiceSignatoryDate: invoiceSignatoryDate,
                reportNumber: reportNumber,
                reportDate: reportDate,
                receivedAmount: receivedAmount,
                receivedDate: receivedDate,
                noReceivedAmount: noReceivedAmount,
                badAmount: badAmount,
                taxRate:taxRate,
                descprition: descprition,
            },
            success: function (res) {
                if (res.result === 0) {
                    layer.msg('添加成功');
                    setTimeout(function () {
                        parent.location.reload();
                    }, 1500)
                } else if (res.code === 0) {
                    layer.msg(res.error);
                }
            }
        })

    })

</script>
</body>
</html>